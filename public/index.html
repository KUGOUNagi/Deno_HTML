<!DOCTYPE html>

<html>

<head>

  <title> しりとりサイト</title>

  <meta charset="utf-8">

  <link rel="stylesheet" href="styles.css">

</head>


<body>

  <h1>しりとりサイト</h1>
  <header>

    <ul class="header-menu">

      <li><a href="index.html">リセットしてプレイ</a></li>

    </ul>

  </header>

  <h2>しりとり</h2>

  <p id="comment">

    <OBJECT DATA="./comment.txt"TYPE="text/plain"></OBJECT>

  </p>

  <button id="startButton">スタート</button>

  <div id="counter"></div>

  <p id="previousWord"></p>

  <input id="nextWordInput" type="text" disabled />

  <button id="nextWordSendButton">送信</button>

  <p id="lose"></p>

  <script type="module">

    window.onload = async (event) => {

      const response = await fetch("/shiritori");

      const previousWord = await response.text();

      const para = document.querySelector("#previousWord");

      para.innerText = `前の単語：${previousWord}`;

      document.getElementById("nextWordSendButton").addEventListener('click', hoge, false);

    };


    document.querySelector("#nextWordSendButton").onclick = async (event) => {

      const nextWord = document.querySelector("#nextWordInput").value;

      loser(nextWord);

      const response = await fetch("/shiritori", {

        method: "POST",

        headers: { "Content-Type": "application/json" },

        body: JSON.stringify({ nextWord })

      });

      if (response.status / 100 !== 2) {

        alert(await response.text());

        return;

      }

      const previousWord = await response.text();

      const para = document.querySelector("#previousWord");

      para.innerText = `前の単語：${previousWord}`;

    };

  </script>

  <script>

    function hoge() {
      document.getElementById("nextWordInput").value='';
    }

  </script>

  <p id="p1">あなたは負けました</p>

  <script>
  //初期表示は非表示
  document.getElementById("p1").style.display ="none";

  function loser(word){
    const p1 = document.getElementById("p1");

    if(word.charAt(word.length - 1) == 'ん'){
      // noneで非表示
      p1.style.display ="block";
    }
  }
  </script>
  <script>
    document.getElementById("counter").style.display ="none";
    let st = document.getElementById('startButton');
    st.addEventListener('click', function(){
      i=30;
      document.getElementById("counter").style.display ="block";
      var box_elem = document.getElementById("nextWordInput");
      box_elem.disabled = false;
  });
    let btn = document.getElementById('nextWordSendButton');
    btn.addEventListener('click', function(){
      i=30;
      id;
  });
  </script>

  <script>
  var fn = function() {
    document.getElementById("counter").innerHTML=i+"秒";
  if(i < 1){
    var box_elem = document.getElementById("nextWordInput");
    box_elem.disabled = true;
    clearInterval(id);} 
  i--;
  }
  var tm = 1000;
  var i = 30;
  var id = setInterval(fn,tm);
  </script>

  <footer>
    <ul class="footer-menu">

      <li><a href="index.html">リセットしてプレイ</a></li>

    </ul>
  </footer>

</body>


</html>